[SERVICE]
    Flush         5
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# API 서비스 로그 수집
[INPUT]
    Name              tail
    Tag               mopl.api
    Path              /var/log/mopl/mopl-api*.json
    Parser            json
    Refresh_Interval  10
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# Batch 서비스 로그 수집
[INPUT]
    Name              tail
    Tag               mopl.batch
    Path              /var/log/mopl/mopl-batch*.json
    Parser            json
    Refresh_Interval  10
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# WebSocket 서비스 로그 수집
[INPUT]
    Name              tail
    Tag               mopl.websocket
    Path              /var/log/mopl/mopl-websocket*.json
    Parser            json
    Refresh_Interval  10
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# SSE 서비스 로그 수집
[INPUT]
    Name              tail
    Tag               mopl.sse
    Path              /var/log/mopl/mopl-sse*.json
    Parser            json
    Refresh_Interval  10
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# Worker 서비스 로그 수집
[INPUT]
    Name              tail
    Tag               mopl.worker
    Path              /var/log/mopl/mopl-worker*.json
    Parser            json
    Refresh_Interval  10
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# 호스트 정보 추가
[FILTER]
    Name          record_modifier
    Match         mopl.*
    Record        hostname ${HOSTNAME}
    Record        env ${ENV}

# S3 출력 (프로덕션)
[OUTPUT]
    Name                         s3
    Match                        mopl.*
    bucket                       ${S3_BUCKET}
    region                       ${AWS_REGION}
    total_file_size              100M
    upload_timeout               10m
    use_put_object               On
    compression                  gzip
    content_type                 application/json
    s3_key_format                /$TAG[1]/%Y/%m/%d/$TAG[1]-%Y-%m-%d-%H.json.gz
    s3_key_format_tag_delimiters .

# CloudWatch 출력 (선택적 - 실시간 모니터링용)
# [OUTPUT]
#     Name                cloudwatch_logs
#     Match               mopl.*
#     region              ${AWS_REGION}
#     log_group_name      /mopl/${ENV}/applications
#     log_stream_prefix   ${HOSTNAME}-
#     auto_create_group   true

# 로컬 디버깅용 stdout 출력 (개발 환경에서만 활성화)
# [OUTPUT]
#     Name   stdout
#     Match  mopl.*
#     Format json_lines
