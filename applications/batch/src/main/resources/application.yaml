spring:
  main:
    web-application-type: none
    keep-alive: true
  application:
    name: mopl-batch

  profiles:
    active: batch, local, cleanup-deletion-log

  # [1] 여기에 Redis 설정을 추가하세요!
  data:
    redis:
      host: localhost  # 로컬이 아니면 IP 입력
      port: 6379

  config:
    import:
      - optional:file:.env[.properties]
      - jpa.yaml
      - storage.yaml
      - openapi.yaml
      - search.yaml

  threads:
    virtual:
      enabled: true

  batch:
    job:
      enabled: false
    jdbc:
      initialize-schema: always

mopl:
  batch:
    run-on-startup:
      enabled: false  # true로 변경하면 시작 시 아래 jobs 실행
      jobs:
        - tmdbGenreSyncJob
        - tsdbLeagueSyncJob
        - tmdbCollectJob
        - tsdbLeagueEventCollectJob

    cleanup:
      defaults:
        chunk-size: ${MOPL_BATCH_CLEANUP_CHUNK_SIZE:500}
        retention-days: ${MOPL_BATCH_CLEANUP_RETENTION_DAYS:30}
      storage:
        chunk-size: ${MOPL_BATCH_CLEANUP_STORAGE_CHUNK_SIZE:200}

    collect:
      tmdb:
        defaults:
          max-page: ${MOPL_BATCH_COLLECT_TMDB_MAX_PAGE:20}
      tsdb:
        defaults:
          sleep-ms: ${MOPL_BATCH_COLLECT_TSDB_SLEEP_MS:300}

    sync:
      es:
        initial-enabled: ${MOPL_BATCH_SYNC_ES_INITIAL_ENABLED:false}
        defaults:
          chunk-size: ${MOPL_BATCH_SYNC_ES_CHUNK_SIZE:500}

  # 모니터링을 위한 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${SPRING_PROFILES_ACTIVE:local}